<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Lumen</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        * {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            background: #000;
            overflow-x: hidden;
        }

        /* Text colors */
        .text-primary {
            color: #f5f5f7;
        }

        .text-secondary {
            color: #86868b;
        }

        /* Card style */
        .card {
            background: rgba(255, 255, 255, 0.04);
            border: 1px solid rgba(255, 255, 255, 0.08);
            transition: all 0.3s ease;
        }

        .card:hover {
            background: rgba(255, 255, 255, 0.06);
            border-color: rgba(255, 255, 255, 0.12);
        }

        /* Buttons */
        .btn-primary {
            background: #0071e3;
            color: #fff;
            font-weight: 500;
            transition: all 0.2s ease;
        }

        .btn-primary:hover {
            background: #0077ed;
        }

        .btn-secondary {
            background: transparent;
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: #fff;
            font-weight: 500;
            transition: all 0.2s ease;
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: rgba(255, 255, 255, 0.3);
        }

        /* Sidebar */
        .sidebar {
            width: 240px;
            position: fixed;
            left: 0;
            top: 0;
            bottom: 0;
            background: #000;
            border-right: 1px solid rgba(255, 255, 255, 0.1);
            z-index: 100;
            transition: transform 0.3s ease;
        }

        .sidebar-hidden {
            transform: translateX(-100%);
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px 16px;
            margin: 2px 12px;
            border-radius: 8px;
            color: #86868b;
            transition: all 0.2s ease;
            cursor: pointer;
            font-size: 14px;
        }

        .nav-item:hover {
            background: rgba(255, 255, 255, 0.05);
            color: #f5f5f7;
        }

        .nav-item.active {
            background: rgba(0, 113, 227, 0.1);
            color: #0071e3;
        }

        /* Main content */
        .main-content {
            margin-left: 240px;
            min-height: 100vh;
            transition: margin-left 0.3s ease;
        }

        .main-content.full-width {
            margin-left: 0;
        }

        /* Mobile overlay */
        .sidebar-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(4px);
            z-index: 90;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .sidebar-overlay.active {
            opacity: 1;
            pointer-events: auto;
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #000;
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.25);
        }

        /* Badge */
        .badge {
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
        }

        .badge-success {
            background: rgba(52, 211, 153, 0.1);
            color: #34d399;
        }

        .badge-warning {
            background: rgba(251, 191, 36, 0.1);
            color: #fbbf24;
        }

        .badge-danger {
            background: rgba(248, 113, 113, 0.1);
            color: #f87171;
        }

        /* Chart container */
        .chart-container {
            position: relative;
            height: 300px;
        }

        /* Page transition */
        .page {
            display: none;
        }

        .page.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }

            .sidebar.mobile-open {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
            }
        }
    </style>
</head>
<body class="bg-black text-white">
    <!-- Sidebar Overlay (Mobile) -->
    <div id="sidebarOverlay" class="sidebar-overlay"></div>

    <!-- Sidebar -->
    <aside id="sidebar" class="sidebar">
        <div class="flex flex-col h-full">
            <!-- Logo -->
            <div class="p-6 border-b border-white/10">
                <div class="flex items-center gap-2.5">
                    <div class="w-8 h-8 rounded-lg bg-white flex items-center justify-center">
                        <svg class="w-5 h-5 text-black" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M11.3 1.046A1 1 0 0112 2v5h4a1 1 0 01.82 1.573l-7 10A1 1 0 018 18v-5H4a1 1 0 01-.82-1.573l7-10a1 1 0 011.12-.38z"/>
                        </svg>
                    </div>
                    <span class="text-lg font-semibold tracking-tight text-primary">Lumen</span>
                </div>
            </div>

            <!-- Navigation -->
            <nav class="flex-1 py-6 overflow-y-auto">
                <div class="space-y-1">
                    <div class="nav-item active" data-page="overview">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"/>
                        </svg>
                        <span>Overview</span>
                    </div>

                    <div class="nav-item" data-page="subscriptions">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                        </svg>
                        <span>Subscriptions</span>
                    </div>

                    <div class="nav-item" data-page="invoices">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                        </svg>
                        <span>Invoices</span>
                    </div>

                    <div class="nav-item opacity-50 cursor-not-allowed" data-page="cloud">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M3 15a4 4 0 004 4h9a5 5 0 10-.1-9.999 5.002 5.002 0 10-9.78 2.096A4.001 4.001 0 003 15z"/>
                        </svg>
                        <span>Cloud Costs</span>
                        <span class="ml-auto text-xs badge badge-warning">Soon</span>
                    </div>

                    <div class="nav-item opacity-50 cursor-not-allowed" data-page="accounts">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"/>
                        </svg>
                        <span>Accounts</span>
                        <span class="ml-auto text-xs badge badge-warning">Soon</span>
                    </div>

                    <div class="nav-item opacity-50 cursor-not-allowed" data-page="reports">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                        </svg>
                        <span>Reports</span>
                        <span class="ml-auto text-xs badge badge-warning">Soon</span>
                    </div>
                </div>

                <!-- Divider -->
                <div class="h-px bg-white/10 my-4 mx-4"></div>

                <!-- Bottom nav items -->
                <div class="space-y-1">
                    <div class="nav-item opacity-50 cursor-not-allowed" data-page="settings">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                        </svg>
                        <span>Settings</span>
                        <span class="ml-auto text-xs badge badge-warning">Soon</span>
                    </div>

                    <div class="nav-item opacity-50 cursor-not-allowed" data-page="api">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"/>
                        </svg>
                        <span>API Keys</span>
                        <span class="ml-auto text-xs badge badge-warning">Soon</span>
                    </div>
                </div>
            </nav>
        </div>
    </aside>

    <!-- Main Content -->
    <main id="mainContent" class="main-content">
        <!-- Top Bar -->
        <div class="sticky top-0 z-50 bg-black/80 backdrop-blur-xl border-b border-white/10">
            <div class="flex items-center justify-between h-16 px-6">
                <!-- Mobile Menu Button -->
                <button id="menuToggle" class="md:hidden w-10 h-10 flex items-center justify-center text-secondary hover:text-white transition-colors">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M4 6h16M4 12h16M4 18h16"/>
                    </svg>
                </button>

                <!-- Search Bar -->
                <div class="hidden md:flex flex-1 max-w-md">
                    <div class="relative w-full">
                        <svg class="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-secondary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                        </svg>
                        <input type="text" placeholder="Search transactions..." class="w-full pl-10 pr-4 py-2 bg-white/5 border border-white/10 rounded-lg text-sm text-white placeholder-secondary focus:outline-none focus:border-[#0071e3] transition-colors">
                    </div>
                </div>

                <!-- User Menu -->
                <div class="flex items-center gap-4">
                    <button class="w-9 h-9 rounded-lg bg-white/5 border border-white/10 flex items-center justify-center text-secondary hover:text-white hover:bg-white/10 transition-colors">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"/>
                        </svg>
                    </button>

                    <div class="relative">
                        <button id="userMenuBtn" class="flex items-center gap-3 p-2 rounded-lg hover:bg-white/5 transition-colors">
                            <div class="w-8 h-8 rounded-full bg-[#0071e3] flex items-center justify-center text-white text-sm font-semibold">
                                J
                            </div>
                            <div class="hidden md:block text-left">
                                <div class="text-sm font-medium text-primary">John Doe</div>
                                <div class="text-xs text-secondary">john@company.com</div>
                            </div>
                            <svg class="hidden md:block w-4 h-4 text-secondary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                            </svg>
                        </button>

                        <!-- Dropdown Menu (Hidden by default) -->
                        <div id="userDropdown" class="hidden absolute right-0 mt-2 w-56 card rounded-xl p-2 shadow-xl">
                            <a href="index.html" class="flex items-center gap-3 px-3 py-2 rounded-lg text-sm text-secondary hover:bg-white/5 hover:text-white transition-colors">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/>
                                </svg>
                                <span>Back to Home</span>
                            </a>
                            <div class="h-px bg-white/10 my-2"></div>
                            <button id="signOutBtn" class="w-full flex items-center gap-3 px-3 py-2 rounded-lg text-sm text-red-400 hover:bg-red-500/10 transition-colors">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/>
                                </svg>
                                <span>Sign Out</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Page Content -->
        <div class="p-6">
            <!-- Overview Page -->
            <div id="overviewPage" class="page active">
                <!-- Welcome Header -->
                <div class="mb-8">
                    <h1 class="text-3xl font-bold text-primary mb-2">Welcome back, John üëã</h1>
                    <p class="text-secondary">Here's what's happening with your finances today.</p>
                </div>

                <!-- KPI Cards -->
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
                    <div class="card rounded-xl p-6">
                        <div class="flex items-center justify-between mb-3">
                            <span class="text-sm text-secondary">Monthly Spend</span>
                            <div class="w-9 h-9 rounded-lg bg-white/10 flex items-center justify-center">
                                <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                </svg>
                            </div>
                        </div>
                        <div class="text-3xl font-semibold text-primary mb-1">$12,847</div>
                        <div class="flex items-center gap-2 text-sm">
                            <span class="text-red-400">‚Üë 8%</span>
                            <span class="text-secondary">from last month</span>
                        </div>
                    </div>

                    <div class="card rounded-xl p-6">
                        <div class="flex items-center justify-between mb-3">
                            <span class="text-sm text-secondary">Savings Found</span>
                            <div class="w-9 h-9 rounded-lg bg-green-500/10 flex items-center justify-center">
                                <svg class="w-5 h-5 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M5 13l4 4L19 7"/>
                                </svg>
                            </div>
                        </div>
                        <div class="text-3xl font-semibold text-green-500 mb-1">$2,732</div>
                        <div class="text-sm text-secondary">Across 14 subscriptions</div>
                    </div>

                    <div class="card rounded-xl p-6">
                        <div class="flex items-center justify-between mb-3">
                            <span class="text-sm text-secondary">Active Subs</span>
                            <div class="w-9 h-9 rounded-lg bg-white/10 flex items-center justify-center">
                                <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                                </svg>
                            </div>
                        </div>
                        <div class="text-3xl font-semibold text-primary mb-1">47</div>
                        <div class="text-sm text-secondary">12 inactive seats detected</div>
                    </div>

                    <div class="card rounded-xl p-6">
                        <div class="flex items-center justify-between mb-3">
                            <span class="text-sm text-secondary">Issues</span>
                            <div class="w-9 h-9 rounded-lg bg-amber-500/10 flex items-center justify-center">
                                <svg class="w-5 h-5 text-amber-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
                                </svg>
                            </div>
                        </div>
                        <div class="text-3xl font-semibold text-amber-500 mb-1">7</div>
                        <div class="text-sm text-secondary">Requiring attention</div>
                    </div>
                </div>

                <!-- Chart Section -->
                <div class="card rounded-xl p-6 mb-8">
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="text-lg font-semibold text-primary">Spending Trend</h2>
                        <div class="flex items-center gap-2">
                            <button class="px-3 py-1.5 rounded-lg bg-[#0071e3] text-white text-sm font-medium">6 Months</button>
                            <button class="px-3 py-1.5 rounded-lg text-secondary hover:bg-white/5 text-sm font-medium transition-colors">1 Year</button>
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="spendingChart"></canvas>
                    </div>
                </div>

                <!-- Two Column Section: Alerts + Recent Invoices -->
                <div class="grid lg:grid-cols-2 gap-6">
                    <!-- Alerts -->
                    <div class="card rounded-xl p-6">
                        <div class="flex items-center justify-between mb-6">
                            <h2 class="text-lg font-semibold text-primary">üö® Critical Alerts</h2>
                            <button class="text-sm text-[#0071e3] hover:underline">View All ‚Üí</button>
                        </div>
                        <div class="space-y-3">
                            <div class="p-4 rounded-lg bg-red-500/10 border border-red-500/20 hover:bg-red-500/15 transition-colors cursor-pointer">
                                <div class="flex items-start gap-3">
                                    <div class="w-10 h-10 rounded-lg bg-red-500/20 flex items-center justify-center flex-shrink-0">
                                        <i class="fab fa-adobe text-red-400"></i>
                                    </div>
                                    <div class="flex-1 min-w-0">
                                        <div class="flex items-center justify-between mb-1">
                                            <h3 class="text-sm font-semibold text-red-400">Duplicate Adobe CC</h3>
                                            <span class="badge badge-danger">Critical</span>
                                        </div>
                                        <p class="text-xs text-secondary mb-2">Two active subscriptions detected</p>
                                        <div class="flex items-center justify-between">
                                            <span class="text-sm font-semibold text-green-500">Save $599/mo</span>
                                            <button class="text-xs text-red-400 hover:text-red-300 font-medium px-3 py-1 rounded-lg bg-red-500/10">Fix Now</button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="p-4 rounded-lg bg-amber-500/10 border border-amber-500/20 hover:bg-amber-500/15 transition-colors cursor-pointer">
                                <div class="flex items-start gap-3">
                                    <div class="w-10 h-10 rounded-lg bg-amber-500/20 flex items-center justify-center flex-shrink-0">
                                        <i class="fab fa-slack text-amber-400"></i>
                                    </div>
                                    <div class="flex-1 min-w-0">
                                        <div class="flex items-center justify-between mb-1">
                                            <h3 class="text-sm font-semibold text-amber-400">12 Unused Slack Seats</h3>
                                            <span class="badge badge-warning">Review</span>
                                        </div>
                                        <p class="text-xs text-secondary mb-2">Inactive for 90+ days</p>
                                        <div class="flex items-center justify-between">
                                            <span class="text-sm font-semibold text-green-500">Save $288/mo</span>
                                            <button class="text-xs text-amber-400 hover:text-amber-300 font-medium px-3 py-1 rounded-lg bg-amber-500/10">Review</button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="p-4 rounded-lg bg-amber-500/10 border border-amber-500/20 hover:bg-amber-500/15 transition-colors cursor-pointer">
                                <div class="flex items-start gap-3">
                                    <div class="w-10 h-10 rounded-lg bg-amber-500/20 flex items-center justify-center flex-shrink-0">
                                        <i class="fab fa-aws text-amber-400"></i>
                                    </div>
                                    <div class="flex-1 min-w-0">
                                        <div class="flex items-center justify-between mb-1">
                                            <h3 class="text-sm font-semibold text-amber-400">AWS Unused EC2 Instances</h3>
                                            <span class="badge badge-warning">Review</span>
                                        </div>
                                        <p class="text-xs text-secondary mb-2">3 instances with 0% utilization</p>
                                        <div class="flex items-center justify-between">
                                            <span class="text-sm font-semibold text-green-500">Save $890/mo</span>
                                            <button class="text-xs text-amber-400 hover:text-amber-300 font-medium px-3 py-1 rounded-lg bg-amber-500/10">Review</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Recent Invoices -->
                    <div class="card rounded-xl p-6">
                        <div class="flex items-center justify-between mb-6">
                            <h2 class="text-lg font-semibold text-primary">üìù Recent Invoices</h2>
                            <button class="text-sm text-[#0071e3] hover:underline">View All ‚Üí</button>
                        </div>
                        <div class="space-y-3">
                            <div class="flex items-center gap-3 p-3 rounded-lg hover:bg-white/5 transition-colors cursor-pointer">
                                <div class="w-10 h-10 rounded-lg bg-white/10 flex items-center justify-center flex-shrink-0">
                                    <i class="fab fa-aws text-white"></i>
                                </div>
                                <div class="flex-1 min-w-0">
                                    <div class="flex items-center justify-between mb-1">
                                        <h3 class="text-sm font-medium text-primary">AWS</h3>
                                        <span class="text-sm font-semibold text-primary">$1,240</span>
                                    </div>
                                    <p class="text-xs text-secondary">Jan 1, 2025 ‚Ä¢ Cloud Services</p>
                                </div>
                            </div>

                            <div class="flex items-center gap-3 p-3 rounded-lg hover:bg-white/5 transition-colors cursor-pointer">
                                <div class="w-10 h-10 rounded-lg bg-white/10 flex items-center justify-center flex-shrink-0">
                                    <i class="fab fa-figma text-white"></i>
                                </div>
                                <div class="flex-1 min-w-0">
                                    <div class="flex items-center justify-between mb-1">
                                        <h3 class="text-sm font-medium text-primary">Figma</h3>
                                        <span class="text-sm font-semibold text-primary">$45</span>
                                    </div>
                                    <p class="text-xs text-secondary">Jan 1, 2025 ‚Ä¢ Design Tool</p>
                                </div>
                            </div>

                            <div class="flex items-center gap-3 p-3 rounded-lg hover:bg-white/5 transition-colors cursor-pointer">
                                <div class="w-10 h-10 rounded-lg bg-white/10 flex items-center justify-center flex-shrink-0">
                                    <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                        <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"/>
                                        <path fill-rule="evenodd" d="M4 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v11a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3zm-3 4a1 1 0 100 2h.01a1 1 0 100-2H7zm3 0a1 1 0 100 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"/>
                                    </svg>
                                </div>
                                <div class="flex-1 min-w-0">
                                    <div class="flex items-center justify-between mb-1">
                                        <h3 class="text-sm font-medium text-primary">Notion</h3>
                                        <span class="text-sm font-semibold text-primary">$96</span>
                                    </div>
                                    <p class="text-xs text-secondary">Jan 1, 2025 ‚Ä¢ Productivity</p>
                                </div>
                            </div>

                            <div class="flex items-center gap-3 p-3 rounded-lg hover:bg-white/5 transition-colors cursor-pointer">
                                <div class="w-10 h-10 rounded-lg bg-white/10 flex items-center justify-center flex-shrink-0">
                                    <i class="fab fa-github text-white"></i>
                                </div>
                                <div class="flex-1 min-w-0">
                                    <div class="flex items-center justify-between mb-1">
                                        <h3 class="text-sm font-medium text-primary">GitHub</h3>
                                        <span class="text-sm font-semibold text-primary">$240</span>
                                    </div>
                                    <p class="text-xs text-secondary">Jan 1, 2025 ‚Ä¢ Development</p>
                                </div>
                            </div>

                            <div class="flex items-center gap-3 p-3 rounded-lg hover:bg-white/5 transition-colors cursor-pointer">
                                <div class="w-10 h-10 rounded-lg bg-white/10 flex items-center justify-center flex-shrink-0">
                                    <i class="fab fa-slack text-white"></i>
                                </div>
                                <div class="flex-1 min-w-0">
                                    <div class="flex items-center justify-between mb-1">
                                        <h3 class="text-sm font-medium text-primary">Slack</h3>
                                        <span class="text-sm font-semibold text-primary">$480</span>
                                    </div>
                                    <p class="text-xs text-secondary">Jan 1, 2025 ‚Ä¢ Communication</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Invoices Page -->
            <div id="invoicesPage" class="page">
                <!-- Page Header -->
                <div class="mb-8">
                    <h1 class="text-3xl font-bold text-primary mb-2">Invoices</h1>
                    <p class="text-secondary">Upload and manage your invoices with AI-powered data extraction.</p>
                </div>

                <!-- Upload Section -->
                <div class="card rounded-xl p-8 mb-8">
                    <h2 class="text-lg font-semibold text-primary mb-4">Upload Invoice</h2>
                    <div id="dropZone" class="border-2 border-dashed border-white/20 rounded-xl p-12 text-center hover:border-[#0071e3] hover:bg-white/[0.02] transition-all cursor-pointer">
                        <svg class="w-12 h-12 mx-auto mb-4 text-secondary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/>
                        </svg>
                        <p class="text-lg text-primary mb-2">Drag & drop invoice here</p>
                        <p class="text-sm text-secondary mb-4">or click to browse files</p>
                        <input type="file" id="fileInput" accept=".pdf,.png,.jpg,.jpeg" class="hidden">
                        <button onclick="document.getElementById('fileInput').click()" class="btn-primary px-6 py-2.5 rounded-lg text-sm">
                            Browse Files
                        </button>
                        <p class="text-xs text-secondary mt-4">Supports: PDF, PNG, JPG (max 10MB)</p>
                    </div>
                    <div id="uploadStatus" class="hidden mt-4 p-4 rounded-lg bg-[#0071e3]/10 border border-[#0071e3]/20 text-[#0071e3] text-sm">
                        <span class="inline-block animate-spin mr-2">‚è≥</span> <span id="statusText">Uploading...</span>
                    </div>
                </div>

                <!-- Stats Summary -->
                <div class="grid grid-cols-1 sm:grid-cols-4 gap-4 mb-8">
                    <div class="card rounded-xl p-6">
                        <span class="text-sm text-secondary block mb-2">Total Invoices</span>
                        <div class="text-3xl font-semibold text-primary" id="totalInvoices">0</div>
                    </div>
                    <div class="card rounded-xl p-6">
                        <span class="text-sm text-secondary block mb-2">Total Amount</span>
                        <div class="text-3xl font-semibold text-primary" id="totalAmount">$0</div>
                    </div>
                    <div class="card rounded-xl p-6">
                        <span class="text-sm text-secondary block mb-2">This Month</span>
                        <div class="text-3xl font-semibold text-primary" id="thisMonth">0</div>
                    </div>
                    <div class="card rounded-xl p-6">
                        <span class="text-sm text-secondary block mb-2">Pending Parsing</span>
                        <div class="flex items-center gap-2">
                            <div class="text-3xl font-semibold text-amber-500" id="pendingParsing">0</div>
                            <span class="badge badge-warning" id="pendingBadge" style="display: none;">Pending</span>
                        </div>
                    </div>
                </div>

                <!-- Invoices Table -->
                <div class="card rounded-xl overflow-hidden">
                    <div class="p-6 border-b border-white/10">
                        <h2 class="text-lg font-semibold text-primary">All Invoices</h2>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead>
                                <tr class="text-left text-sm text-secondary border-b border-white/10">
                                    <th class="px-6 py-4 font-medium">Vendor</th>
                                    <th class="px-6 py-4 font-medium">Amount</th>
                                    <th class="px-6 py-4 font-medium">Date</th>
                                    <th class="px-6 py-4 font-medium">Status</th>
                                    <th class="px-6 py-4 font-medium">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="invoicesTableBody" class="text-sm">
                                <!-- Empty state -->
                                <tr id="emptyState">
                                    <td colspan="5" class="px-6 py-12 text-center">
                                        <svg class="w-16 h-16 mx-auto mb-4 text-secondary opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                                        </svg>
                                        <p class="text-secondary mb-2">No invoices yet</p>
                                        <p class="text-sm text-secondary opacity-75">Upload your first invoice to get started</p>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Subscriptions Page -->
            <div id="subscriptionsPage" class="page">
                <!-- Page Header -->
                <div class="mb-8">
                    <h1 class="text-3xl font-bold text-primary mb-2">Subscriptions</h1>
                    <p class="text-secondary">Manage all your recurring subscriptions and find savings opportunities.</p>
                </div>

                <!-- Stats Summary -->
                <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mb-8">
                    <div class="card rounded-xl p-6">
                        <span class="text-sm text-secondary block mb-2">Total Subscriptions</span>
                        <div class="text-3xl font-semibold text-primary">47</div>
                    </div>
                    <div class="card rounded-xl p-6">
                        <span class="text-sm text-secondary block mb-2">Monthly Cost</span>
                        <div class="text-3xl font-semibold text-primary">$6,543</div>
                    </div>
                    <div class="card rounded-xl p-6">
                        <span class="text-sm text-secondary block mb-2">Potential Savings</span>
                        <div class="text-3xl font-semibold text-green-500">$1,777</div>
                    </div>
                </div>

                <!-- Filters and Search -->
                <div class="card rounded-xl p-4 mb-6">
                    <div class="flex flex-col md:flex-row gap-4 md:items-center md:justify-between">
                        <div class="flex gap-2">
                            <button class="px-4 py-2 rounded-lg bg-[#0071e3] text-white text-sm font-medium">All</button>
                            <button class="px-4 py-2 rounded-lg text-secondary hover:bg-white/5 text-sm font-medium transition-colors">Active</button>
                            <button class="px-4 py-2 rounded-lg text-secondary hover:bg-white/5 text-sm font-medium transition-colors">Issues</button>
                            <button class="px-4 py-2 rounded-lg text-secondary hover:bg-white/5 text-sm font-medium transition-colors">Inactive</button>
                        </div>
                        <div class="relative">
                            <svg class="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-secondary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                            </svg>
                            <input type="text" placeholder="Search subscriptions..." class="pl-10 pr-4 py-2 bg-white/5 border border-white/10 rounded-lg text-sm text-white placeholder-secondary focus:outline-none focus:border-[#0071e3] transition-colors">
                        </div>
                    </div>
                </div>

                <!-- Subscriptions Table -->
                <div class="card rounded-xl overflow-hidden">
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead>
                                <tr class="text-left text-sm text-secondary border-b border-white/10">
                                    <th class="px-6 py-4 font-medium">Service</th>
                                    <th class="px-6 py-4 font-medium">Cost</th>
                                    <th class="px-6 py-4 font-medium">Frequency</th>
                                    <th class="px-6 py-4 font-medium">Next Billing</th>
                                    <th class="px-6 py-4 font-medium">Status</th>
                                    <th class="px-6 py-4 font-medium">Actions</th>
                                </tr>
                            </thead>
                            <tbody class="text-sm">
                                <tr class="border-b border-white/5 hover:bg-white/[0.02] transition-colors">
                                    <td class="px-6 py-4">
                                        <div class="flex items-center gap-3">
                                            <div class="w-10 h-10 rounded-lg bg-white/10 flex items-center justify-center">
                                                <i class="fab fa-adobe text-red-400"></i>
                                            </div>
                                            <div>
                                                <div class="font-medium text-primary">Adobe Creative Cloud</div>
                                                <div class="text-xs text-secondary">Design & Video</div>
                                            </div>
                                        </div>
                                    </td>
                                    <td class="px-6 py-4 text-primary font-medium">$599.88</td>
                                    <td class="px-6 py-4 text-secondary">Monthly</td>
                                    <td class="px-6 py-4 text-secondary">Jan 15, 2025</td>
                                    <td class="px-6 py-4">
                                        <span class="badge badge-danger">Duplicate</span>
                                    </td>
                                    <td class="px-6 py-4">
                                        <button class="text-[#0071e3] hover:underline text-sm">Fix Issue</button>
                                    </td>
                                </tr>

                                <tr class="border-b border-white/5 hover:bg-white/[0.02] transition-colors">
                                    <td class="px-6 py-4">
                                        <div class="flex items-center gap-3">
                                            <div class="w-10 h-10 rounded-lg bg-white/10 flex items-center justify-center">
                                                <i class="fab fa-slack text-white"></i>
                                            </div>
                                            <div>
                                                <div class="font-medium text-primary">Slack</div>
                                                <div class="text-xs text-secondary">Communication</div>
                                            </div>
                                        </div>
                                    </td>
                                    <td class="px-6 py-4 text-primary font-medium">$480.00</td>
                                    <td class="px-6 py-4 text-secondary">Monthly</td>
                                    <td class="px-6 py-4 text-secondary">Jan 8, 2025</td>
                                    <td class="px-6 py-4">
                                        <span class="badge badge-warning">12 Inactive</span>
                                    </td>
                                    <td class="px-6 py-4">
                                        <button class="text-[#0071e3] hover:underline text-sm">Review</button>
                                    </td>
                                </tr>

                                <tr class="border-b border-white/5 hover:bg-white/[0.02] transition-colors">
                                    <td class="px-6 py-4">
                                        <div class="flex items-center gap-3">
                                            <div class="w-10 h-10 rounded-lg bg-white/10 flex items-center justify-center">
                                                <i class="fab fa-github text-white"></i>
                                            </div>
                                            <div>
                                                <div class="font-medium text-primary">GitHub Enterprise</div>
                                                <div class="text-xs text-secondary">Development</div>
                                            </div>
                                        </div>
                                    </td>
                                    <td class="px-6 py-4 text-primary font-medium">$240.00</td>
                                    <td class="px-6 py-4 text-secondary">Monthly</td>
                                    <td class="px-6 py-4 text-secondary">Jan 12, 2025</td>
                                    <td class="px-6 py-4">
                                        <span class="badge badge-success">Active</span>
                                    </td>
                                    <td class="px-6 py-4">
                                        <button class="text-secondary hover:text-white text-sm">Manage</button>
                                    </td>
                                </tr>

                                <tr class="border-b border-white/5 hover:bg-white/[0.02] transition-colors">
                                    <td class="px-6 py-4">
                                        <div class="flex items-center gap-3">
                                            <div class="w-10 h-10 rounded-lg bg-white/10 flex items-center justify-center">
                                                <i class="fab fa-figma text-white"></i>
                                            </div>
                                            <div>
                                                <div class="font-medium text-primary">Figma Professional</div>
                                                <div class="text-xs text-secondary">Design Tool</div>
                                            </div>
                                        </div>
                                    </td>
                                    <td class="px-6 py-4 text-primary font-medium">$45.00</td>
                                    <td class="px-6 py-4 text-secondary">Monthly</td>
                                    <td class="px-6 py-4 text-secondary">Jan 20, 2025</td>
                                    <td class="px-6 py-4">
                                        <span class="badge badge-success">Active</span>
                                    </td>
                                    <td class="px-6 py-4">
                                        <button class="text-secondary hover:text-white text-sm">Manage</button>
                                    </td>
                                </tr>

                                <tr class="border-b border-white/5 hover:bg-white/[0.02] transition-colors">
                                    <td class="px-6 py-4">
                                        <div class="flex items-center gap-3">
                                            <div class="w-10 h-10 rounded-lg bg-white/10 flex items-center justify-center">
                                                <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                                    <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"/>
                                                    <path fill-rule="evenodd" d="M4 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v11a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3zm-3 4a1 1 0 100 2h.01a1 1 0 100-2H7zm3 0a1 1 0 100 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"/>
                                                </svg>
                                            </div>
                                            <div>
                                                <div class="font-medium text-primary">Notion Team</div>
                                                <div class="text-xs text-secondary">Productivity</div>
                                            </div>
                                        </div>
                                    </td>
                                    <td class="px-6 py-4 text-primary font-medium">$96.00</td>
                                    <td class="px-6 py-4 text-secondary">Monthly</td>
                                    <td class="px-6 py-4 text-secondary">Jan 5, 2025</td>
                                    <td class="px-6 py-4">
                                        <span class="badge badge-success">Active</span>
                                    </td>
                                    <td class="px-6 py-4">
                                        <button class="text-secondary hover:text-white text-sm">Manage</button>
                                    </td>
                                </tr>

                                <tr class="hover:bg-white/[0.02] transition-colors">
                                    <td class="px-6 py-4">
                                        <div class="flex items-center gap-3">
                                            <div class="w-10 h-10 rounded-lg bg-white/10 flex items-center justify-center">
                                                <i class="fab fa-dropbox text-white"></i>
                                            </div>
                                            <div>
                                                <div class="font-medium text-primary">Dropbox Business</div>
                                                <div class="text-xs text-secondary">Cloud Storage</div>
                                            </div>
                                        </div>
                                    </td>
                                    <td class="px-6 py-4 text-primary font-medium">$150.00</td>
                                    <td class="px-6 py-4 text-secondary">Monthly</td>
                                    <td class="px-6 py-4 text-secondary">Jan 25, 2025</td>
                                    <td class="px-6 py-4">
                                        <span class="badge badge-success">Active</span>
                                    </td>
                                    <td class="px-6 py-4">
                                        <button class="text-secondary hover:text-white text-sm">Manage</button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        // Initialize Supabase (if you want auth to work)
        const SUPABASE_URL = 'https://glfonhajcpmwgutsohpi.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdsZm9uaGFqY3Btd2d1dHNvaHBpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ2MTAxNDgsImV4cCI6MjA4MDE4NjE0OH0.wmR6zcr4s_9lOu6VsheVuw3_bbNeihNX2d1rLl18DUE';
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // Mobile menu toggle
        const menuToggle = document.getElementById('menuToggle');
        const sidebar = document.getElementById('sidebar');
        const sidebarOverlay = document.getElementById('sidebarOverlay');

        menuToggle.addEventListener('click', () => {
            sidebar.classList.toggle('mobile-open');
            sidebarOverlay.classList.toggle('active');
        });

        sidebarOverlay.addEventListener('click', () => {
            sidebar.classList.remove('mobile-open');
            sidebarOverlay.classList.remove('active');
        });

        // User dropdown toggle
        const userMenuBtn = document.getElementById('userMenuBtn');
        const userDropdown = document.getElementById('userDropdown');

        userMenuBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            userDropdown.classList.toggle('hidden');
        });

        document.addEventListener('click', () => {
            userDropdown.classList.add('hidden');
        });

        // Sign out
        document.getElementById('signOutBtn').addEventListener('click', async () => {
            await supabase.auth.signOut();
            window.location.href = 'index.html';
        });

        // Page navigation
        const navItems = document.querySelectorAll('.nav-item');
        const pages = document.querySelectorAll('.page');

        navItems.forEach(item => {
            item.addEventListener('click', () => {
                // Skip if disabled
                if (item.classList.contains('cursor-not-allowed')) return;

                const pageId = item.dataset.page;

                // Update active nav
                navItems.forEach(nav => nav.classList.remove('active'));
                item.classList.add('active');

                // Update active page
                pages.forEach(page => page.classList.remove('active'));
                document.getElementById(pageId + 'Page').classList.add('active');

                // Close mobile menu
                sidebar.classList.remove('mobile-open');
                sidebarOverlay.classList.remove('active');
            });
        });

        // Initialize Chart.js
        const ctx = document.getElementById('spendingChart').getContext('2d');
        const spendingChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: ['Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan'],
                datasets: [{
                    label: 'Monthly Spend',
                    data: [8420, 9150, 10200, 11840, 11890, 12847],
                    borderColor: '#0071e3',
                    backgroundColor: 'rgba(0, 113, 227, 0.1)',
                    borderWidth: 2,
                    tension: 0.4,
                    fill: true,
                    pointRadius: 4,
                    pointHoverRadius: 6,
                    pointBackgroundColor: '#0071e3',
                    pointBorderColor: '#fff',
                    pointBorderWidth: 2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    },
                    tooltip: {
                        backgroundColor: 'rgba(0, 0, 0, 0.8)',
                        titleColor: '#f5f5f7',
                        bodyColor: '#86868b',
                        borderColor: 'rgba(255, 255, 255, 0.1)',
                        borderWidth: 1,
                        padding: 12,
                        displayColors: false,
                        callbacks: {
                            label: function(context) {
                                return '$' + context.parsed.y.toLocaleString();
                            }
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: false,
                        ticks: {
                            color: '#86868b',
                            callback: function(value) {
                                return '$' + (value / 1000) + 'k';
                            }
                        },
                        grid: {
                            color: 'rgba(255, 255, 255, 0.05)',
                            drawBorder: false
                        }
                    },
                    x: {
                        ticks: {
                            color: '#86868b'
                        },
                        grid: {
                            display: false
                        }
                    }
                }
            }
        });

        // Check auth on load
        async function checkAuth() {
            const { data: { session } } = await supabase.auth.getSession();
            if (!session) {
                window.location.href = 'index.html';
            }
        }
        checkAuth();

        // ========== INVOICES PAGE FUNCTIONALITY ==========
        
        // OpenRouter API configuration
        const OPENROUTER_API_KEY = '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';
        const OPENROUTER_MODEL = 'openai/gpt-4o-mini:free';

        // Groq API configuration  
        const GROQ_API_KEY = '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';

        // Drag and drop functionality
        const dropZone = document.getElementById('dropZone');
        const fileInput = document.getElementById('fileInput');
        const uploadStatus = document.getElementById('uploadStatus');
        const statusText = document.getElementById('statusText');

        if (dropZone && fileInput) {
            // Prevent default drag behaviors
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                dropZone.addEventListener(eventName, preventDefaults, false);
                document.body.addEventListener(eventName, preventDefaults, false);
            });

            function preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }

            // Highlight drop zone when item is dragged over it
            ['dragenter', 'dragover'].forEach(eventName => {
                dropZone.addEventListener(eventName, () => {
                    dropZone.classList.add('border-[#0071e3]', 'bg-white/[0.02]');
                });
            });

            ['dragleave', 'drop'].forEach(eventName => {
                dropZone.addEventListener(eventName, () => {
                    dropZone.classList.remove('border-[#0071e3]', 'bg-white/[0.02]');
                });
            });

            // Handle dropped files
            dropZone.addEventListener('drop', (e) => {
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    handleFile(files[0]);
                }
            });

            // Handle file input change
            fileInput.addEventListener('change', (e) => {
                if (e.target.files.length > 0) {
                    handleFile(e.target.files[0]);
                }
            });
        }

        // Handle file upload and AI parsing
        async function handleFile(file) {
            // Validate file type
            const validTypes = ['image/png', 'image/jpeg', 'image/jpg', 'application/pdf'];
            if (!validTypes.includes(file.type)) {
                alert('Please upload a PDF, PNG, or JPG file');
                return;
            }

            // Validate file size (10MB)
            if (file.size > 10 * 1024 * 1024) {
                alert('File size must be less than 10MB');
                return;
            }

            try {
                // Show upload status
                uploadStatus.classList.remove('hidden');
                statusText.textContent = 'Uploading file...';

                // Get current user
                const { data: { session } } = await supabase.auth.getSession();
                if (!session) return;

                // Upload to Supabase Storage
                const fileExt = file.name.split('.').pop();
                const fileName = `${Date.now()}.${fileExt}`;
                const filePath = `${session.user.id}/${fileName}`;

                const { data: uploadData, error: uploadError } = await supabase.storage
                    .from('invoices')
                    .upload(filePath, file);

                if (uploadError) throw uploadError;

                // Get file URL
                const { data: { publicUrl } } = supabase.storage
                    .from('invoices')
                    .getPublicUrl(filePath);

                // Parse with OpenRouter AI (for images only, PDFs need different handling)
                statusText.textContent = 'Parsing invoice with AI...';
                let parsedData = await parseInvoiceWithAI(file);

                // Save to database
                statusText.textContent = 'Saving to database...';
                const { data: invoiceData, error: dbError } = await supabase
                    .from('invoices')
                    .insert({
                        user_id: session.user.id,
                        vendor: parsedData.vendor,
                        amount: parsedData.amount,
                        currency: 'USD',
                        invoice_date: parsedData.date,
                        parsed_data: parsedData,
                        storage_path: publicUrl
                    })
                    .select()
                    .single();

                if (dbError) throw dbError;

                // Success!
                uploadStatus.classList.add('hidden');
                alert('Invoice uploaded and parsed successfully!');
                
                // Reload invoices
                await loadInvoices();

                // Reset file input
                fileInput.value = '';

            } catch (error) {
                console.error('Error uploading invoice:', error);
                uploadStatus.classList.add('hidden');
                alert('Error uploading invoice: ' + error.message);
            }
        }

        // Parse invoice using OpenRouter AI
        async function parseInvoiceWithAI(file) {
            try {
                // Convert file to base64 for image files
                const base64 = await fileToBase64(file);
                
                const response = await fetch('https://openrouter.ai/api/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${OPENROUTER_API_KEY}`,
                        'Content-Type': 'application/json',
                        'HTTP-Referer': window.location.href
                    },
                    body: JSON.stringify({
                        model: OPENROUTER_MODEL,
                        messages: [
                            {
                                role: 'user',
                                content: [
                                    {
                                        type: 'text',
                                        text: 'Extract the vendor name, total amount (numbers only, no currency symbol), and invoice date (in YYYY-MM-DD format) from this invoice image. Return ONLY a JSON object with keys: vendor, amount, date. No other text.'
                                    },
                                    {
                                        type: 'image_url',
                                        image_url: {
                                            url: base64
                                        }
                                    }
                                ]
                            }
                        ]
                    })
                });

                const data = await response.json();
                const content = data.choices[0].message.content;
                
                // Parse JSON response
                const jsonMatch = content.match(/\{[^}]+\}/);
                if (jsonMatch) {
                    const parsed = JSON.parse(jsonMatch[0]);
                    return {
                        vendor: parsed.vendor || 'Unknown Vendor',
                        amount: parseFloat(parsed.amount) || 0,
                        date: parsed.date || new Date().toISOString().split('T')[0]
                    };
                }

                // Fallback
                return {
                    vendor: 'Unknown Vendor',
                    amount: 0,
                    date: new Date().toISOString().split('T')[0]
                };

            } catch (error) {
                console.error('AI parsing error:', error);
                // Return fallback data
                return {
                    vendor: 'Unknown Vendor',
                    amount: 0,
                    date: new Date().toISOString().split('T')[0]
                };
            }
        }

        // Convert file to base64
        function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => resolve(reader.result);
                reader.onerror = error => reject(error);
            });
        }

        // Load invoices from database
        async function loadInvoices() {
            try {
                const { data: { session } } = await supabase.auth.getSession();
                if (!session) return;

                const { data: invoices, error } = await supabase
                    .from('invoices')
                    .select('*')
                    .eq('user_id', session.user.id)
                    .order('created_at', { ascending: false });

                if (error) throw error;

                // Update stats
                const totalInvoices = invoices.length;
                const totalAmount = invoices.reduce((sum, inv) => sum + (inv.amount || 0), 0);
                
                const thisMonth = new Date();
                const thisMonthInvoices = invoices.filter(inv => {
                    const invDate = new Date(inv.invoice_date);
                    return invDate.getMonth() === thisMonth.getMonth() && 
                           invDate.getFullYear() === thisMonth.getFullYear();
                }).length;

                document.getElementById('totalInvoices').textContent = totalInvoices;
                document.getElementById('totalAmount').textContent = '$' + totalAmount.toLocaleString();
                document.getElementById('thisMonth').textContent = thisMonthInvoices;
                document.getElementById('pendingParsing').textContent = '0';

                // Populate table
                const tbody = document.getElementById('invoicesTableBody');
                const emptyState = document.getElementById('emptyState');

                if (invoices.length === 0) {
                    emptyState.style.display = '';
                } else {
                    emptyState.style.display = 'none';

                    // Clear existing rows (except empty state)
                    while (tbody.children.length > 1) {
                        tbody.removeChild(tbody.lastChild);
                    }

                    // Add invoice rows
                    invoices.forEach(invoice => {
                        const row = document.createElement('tr');
                        row.className = 'border-b border-white/5 hover:bg-white/[0.02] transition-colors';
                        row.innerHTML = `
                            <td class="px-6 py-4">
                                <div class="flex items-center gap-3">
                                    <div class="w-10 h-10 rounded-lg bg-white/10 flex items-center justify-center flex-shrink-0">
                                        <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                                        </svg>
                                    </div>
                                    <span class="font-medium text-primary">${invoice.vendor}</span>
                                </div>
                            </td>
                            <td class="px-6 py-4 text-primary font-medium">$${invoice.amount.toLocaleString()}</td>
                            <td class="px-6 py-4 text-secondary">${new Date(invoice.invoice_date).toLocaleDateString()}</td>
                            <td class="px-6 py-4">
                                <span class="badge badge-success">Parsed</span>
                            </td>
                            <td class="px-6 py-4">
                                <div class="flex items-center gap-2">
                                    <a href="${invoice.storage_path}" target="_blank" class="text-[#0071e3] hover:underline text-sm">View</a>
                                    <button onclick="deleteInvoice('${invoice.id}')" class="text-red-400 hover:text-red-300 text-sm">Delete</button>
                                </div>
                            </td>
                        `;
                        tbody.appendChild(row);
                    });
                }

            } catch (error) {
                console.error('Error loading invoices:', error);
            }
        }

        // Delete invoice
        window.deleteInvoice = async function(invoiceId) {
            if (!confirm('Are you sure you want to delete this invoice?')) return;

            try {
                const { error } = await supabase
                    .from('invoices')
                    .delete()
                    .eq('id', invoiceId);

                if (error) throw error;

                await loadInvoices();
            } catch (error) {
                console.error('Error deleting invoice:', error);
                alert('Error deleting invoice');
            }
        };

        // Load invoices when the invoices page becomes active
        const invoicesNavItem = document.querySelector('[data-page="invoices"]');
        if (invoicesNavItem) {
            invoicesNavItem.addEventListener('click', loadInvoices);
        }
    </script>
</body>
</html>
